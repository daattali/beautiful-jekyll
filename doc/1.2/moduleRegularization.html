<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DGtal: Digital surface regularization by normal vector alignment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-blue.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DGtal
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Digital surface regularization by normal vector alignment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#moduleReg_sec1">Introduction</a></li>
<li class="level1"><a href="#moduleReg_sec2">Main usages</a></li>
<li class="level1"><a href="#moduleReg_seclocal">Local control</a></li>
</ul>
</div>
<div class="textblock"><dl class="section user"><dt>Author(s) of this documentation: </dt><dd>David Coeurjolly</dd></dl>
<p>Part of the <a class="el" href="packageGeometry.html">Geometry package</a>.</p>
<p>This part of the manual describes classes and functions related to the regularization of digital surfaces: Given an input normal vector field attached to digital surface surfels, the regularization outputs a piecewise smooth quadrangulated surface such that each quad is as perpendicular as possible to the input normal vector field. For more details, please refer to <a class="el" href="citelist.html#CITEREF_coeurjolly17regDGCI">[28]</a> and <a class="el" href="citelist.html#CITEREF_coeurjolly18siggraphtalk">[29]</a>.</p>
<p>Related example: <a class="el" href="testDigitalSurfaceRegularization_8cpp.html">geometry/surfaces/testDigitalSurfaceRegularization.cpp</a></p>
<dl class="section note"><dt>Note</dt><dd>In opposition to the method described in <a class="el" href="moduleShrouds.html">Digital surface regularization using the Shrouds algorithm</a>, this digital surface regularization method is not limited to closed surfaces and can process open digital surfaces. Furthermore, the optimized energy is convex and fewer iterations are needed to converge to the optimal position. The price to pay is the computation of an estimated normal vector field.</dd></dl>
<h1><a class="anchor" id="moduleReg_sec1"></a>
Introduction</h1>
<p>If \(P\) denotes the vertices of the input digital surface, \(F\) the set of (quadrilateral) faces and \(n_f\) an estimated normal vector on the face \(f\), we want the quad surface vertex positions \(P^*\) that minimizes the following energy function:</p>
<p class="formulaDsp">
\[\mathcal{E}(P) := \alpha \sum_{i=1}^{n} \|p_i - \hat{p}_i\|^2 + \beta \sum_{f\in F} \sum_{{e_j} \in \partial{f} } ( e_j \cdot n_{f} )^2 + \gamma \sum_{i=1}^{n} \|\hat{p}_i - \hat{b}_i\|^2\,.\]
</p>
<p>where \(&quot;\cdot&quot;\) is the standard \(\mathbb{R}^3\) scalar product, \(e_j\in \partial{f}\) is an edge of the face \(f\) (and is equal to some \(p_k - p_l\)) and \( \hat{b}_i\) is the barycenter of the vertices adjacent to \(\hat{p}_i\).</p>
<p>The energy function is convex and can be minimized by solving a linear system as described in <a class="el" href="citelist.html#CITEREF_coeurjolly17regDGCI">[28]</a>. This minimization scheme is available in the DGtalTools (see volSurfaceRegularization). In this implementation, we consider an iterative scheme (gradient descent strategy) which allows us a finer control of the process.</p>
<h1><a class="anchor" id="moduleReg_sec2"></a>
Main usages</h1>
<p>Starting from an implicit digital surface:</p>
<div class="fragment"><div class="line">  <span class="keyword">typedef</span> Shortcuts&lt;Z3i::KSpace&gt; <a class="code" href="testArithmeticalDSSComputerOnSurfels_8cpp.html#ac6834e172d5d8c2b796bc846aa0d643b">SH3</a>;</div>
<div class="line">  <span class="keyword">typedef</span> ShortcutsGeometry&lt;Z3i::KSpace&gt; <a class="code" href="testIntegralInvariantShortcuts_8cpp.html#ae4f1207d47e755c2bacefd09fa73c44f">SHG3</a>;</div>
<div class="line">  <span class="keyword">auto</span> params = <a class="code" href="classDGtal_1_1Shortcuts.html#ac893d3bc87b6dee19a48044627c42df9">SH3::defaultParameters</a>()</div>
<div class="line">  | <a class="code" href="classDGtal_1_1ShortcutsGeometry.html#ab5cadcb5184506f8b51bea27df021221">SHG3::defaultParameters</a>();</div>
<div class="line">  </div>
<div class="line">  params( <span class="stringliteral">&quot;polynomial&quot;</span>, <span class="stringliteral">&quot;goursat&quot;</span> )( <span class="stringliteral">&quot;gridstep&quot;</span>, 1.0)(<span class="stringliteral">&quot;verbose&quot;</span>, 0);</div>
<div class="line">  <span class="keyword">auto</span> implicit_shape  = <a class="code" href="classDGtal_1_1Shortcuts.html#a125018cf8ad78a3432d06ef36931569d">SH3::makeImplicitShape3D</a>  ( params );</div>
<div class="line">  <span class="keyword">auto</span> digitized_shape = <a class="code" href="classDGtal_1_1Shortcuts.html#a44f488610c74747a5ca55b0d728865ee">SH3::makeDigitizedImplicitShape3D</a>( implicit_shape, params );</div>
<div class="line">  <span class="keyword">auto</span> <a class="code" href="testCubicalComplex_8cpp.html#a2b87ed989d2519d025bd5d4fbcbac062">K</a>               = <a class="code" href="classDGtal_1_1Shortcuts.html#a25d0be45d2b76a79be6cc83c8e2442b2">SH3::getKSpace</a>( params );</div>
<div class="ttc" id="aclassDGtal_1_1ShortcutsGeometry_html_ab5cadcb5184506f8b51bea27df021221"><div class="ttname"><a href="classDGtal_1_1ShortcutsGeometry.html#ab5cadcb5184506f8b51bea27df021221">DGtal::ShortcutsGeometry::defaultParameters</a></div><div class="ttdeci">static Parameters defaultParameters()</div><div class="ttdef"><b>Definition:</b> <a href="ShortcutsGeometry_8h_source.html#l00209">ShortcutsGeometry.h:209</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_a125018cf8ad78a3432d06ef36931569d"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#a125018cf8ad78a3432d06ef36931569d">DGtal::Shortcuts::makeImplicitShape3D</a></div><div class="ttdeci">static CountedPtr&lt; ImplicitShape3D &gt; makeImplicitShape3D(const Parameters &amp;params=parametersImplicitShape3D())</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l00281">Shortcuts.h:281</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_a25d0be45d2b76a79be6cc83c8e2442b2"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#a25d0be45d2b76a79be6cc83c8e2442b2">DGtal::Shortcuts::getKSpace</a></div><div class="ttdeci">static KSpace getKSpace(const Point &amp;low, const Point &amp;up, Parameters params=parametersKSpace())</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l00331">Shortcuts.h:331</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_a44f488610c74747a5ca55b0d728865ee"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#a44f488610c74747a5ca55b0d728865ee">DGtal::Shortcuts::makeDigitizedImplicitShape3D</a></div><div class="ttdeci">static CountedPtr&lt; DigitizedImplicitShape3D &gt; makeDigitizedImplicitShape3D(CountedPtr&lt; ImplicitShape3D &gt; shape, Parameters params=parametersDigitizedImplicitShape3D())</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l00521">Shortcuts.h:522</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_ac893d3bc87b6dee19a48044627c42df9"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#ac893d3bc87b6dee19a48044627c42df9">DGtal::Shortcuts::defaultParameters</a></div><div class="ttdeci">static Parameters defaultParameters()</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l00202">Shortcuts.h:202</a></div></div>
<div class="ttc" id="atestArithmeticalDSSComputerOnSurfels_8cpp_html_ac6834e172d5d8c2b796bc846aa0d643b"><div class="ttname"><a href="testArithmeticalDSSComputerOnSurfels_8cpp.html#ac6834e172d5d8c2b796bc846aa0d643b">SH3</a></div><div class="ttdeci">Shortcuts&lt; KSpace &gt; SH3</div><div class="ttdef"><b>Definition:</b> <a href="testArithmeticalDSSComputerOnSurfels_8cpp_source.html#l00049">testArithmeticalDSSComputerOnSurfels.cpp:49</a></div></div>
<div class="ttc" id="atestCubicalComplex_8cpp_html_a2b87ed989d2519d025bd5d4fbcbac062"><div class="ttname"><a href="testCubicalComplex_8cpp.html#a2b87ed989d2519d025bd5d4fbcbac062">K</a></div><div class="ttdeci">KSpace K</div><div class="ttdef"><b>Definition:</b> <a href="testCubicalComplex_8cpp_source.html#l00062">testCubicalComplex.cpp:62</a></div></div>
<div class="ttc" id="atestIntegralInvariantShortcuts_8cpp_html_ae4f1207d47e755c2bacefd09fa73c44f"><div class="ttname"><a href="testIntegralInvariantShortcuts_8cpp.html#ae4f1207d47e755c2bacefd09fa73c44f">SHG3</a></div><div class="ttdeci">ShortcutsGeometry&lt; Z3i::KSpace &gt; SHG3</div><div class="ttdef"><b>Definition:</b> <a href="testIntegralInvariantShortcuts_8cpp_source.html#l00047">testIntegralInvariantShortcuts.cpp:47</a></div></div>
</div><!-- fragment --><p> with the following geometry (with a gridstep set to 0.3):</p>
<div class="image">
<img src="regOrig.png" alt=""/>
<div class="caption">
Input digital surface.</div></div>
<p>The regularization class instance can be set up using the following syntax:</p>
<div class="fragment"><div class="line">    <span class="keyword">auto</span> surface         = <a class="code" href="classDGtal_1_1Shortcuts.html#a93309902099a369efffe30a7e849673e">SH3::makeDigitalSurface</a>( digitized_shape, <a class="code" href="testCubicalComplex_8cpp.html#a2b87ed989d2519d025bd5d4fbcbac062">K</a>, params );</div>
<div class="line">    <span class="keyword">auto</span> surfels         = <a class="code" href="classDGtal_1_1Shortcuts.html#a883a5d30e0c886e8c27c7f6f45188313">SH3::getSurfelRange</a>( surface, params );</div>
<div class="line">    DigitalSurfaceRegularization&lt;SH3::DigitalSurface&gt; regul(surface);</div>
<div class="line">    regul.init();</div>
<div class="line">    regul.attachConvolvedTrivialNormalVectors(params);</div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_a883a5d30e0c886e8c27c7f6f45188313"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#a883a5d30e0c886e8c27c7f6f45188313">DGtal::Shortcuts::getSurfelRange</a></div><div class="ttdeci">static SurfelRange getSurfelRange(CountedPtr&lt; ::DGtal::DigitalSurface&lt; TDigitalSurfaceContainer &gt; &gt; surface, const Parameters &amp;params=parametersDigitalSurface())</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l01545">Shortcuts.h:1546</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_a93309902099a369efffe30a7e849673e"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#a93309902099a369efffe30a7e849673e">DGtal::Shortcuts::makeDigitalSurface</a></div><div class="ttdeci">static CountedPtr&lt; DigitalSurface &gt; makeDigitalSurface(CountedPtr&lt; TPointPredicate &gt; bimage, const KSpace &amp;K, const Parameters &amp;params=parametersDigitalSurface())</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l01207">Shortcuts.h:1208</a></div></div>
</div><!-- fragment --><p> The <a class="el" href="classDGtal_1_1DigitalSurfaceRegularization.html#a0af634dec99b69da5b921e64a4cf9153" title="Initialize the parameters of the energy function.">DigitalSurfaceRegularization::init()</a> method sets some default values for the \(\alpha\), \(\beta\) and \(\gamma\) parameters. Such parameters can be either chosen as global values (e.g. <em>init(alpha,beta,gamma)</em>), or as local weights. In the latter case, the user must specify a vector of \(\alpha[i]\), \(\beta[i]\) and \(\gamma[i]\) values, one per digital surface pointels (see <a class="el" href="moduleRegularization.html#moduleReg_seclocal">Local control</a>). In this example, the normal vector field attached to the surfels is a trivial normal estimator whose normals are given by local convolution of input quad normals. We can now minimize the energy as follows: </p><div class="fragment"><div class="line">    <span class="keyword">auto</span> finalenergy = regul.regularize();</div>
</div><!-- fragment --><p> Note that the user can specify the number of steps of the gradient descent as well as the initial learning rate. Note that if the <a class="el" href="classDGtal_1_1DigitalSurfaceRegularization.html#ab0c787fe879c43a3a1ece4c518de7dca" title="Main regularization loop.">DigitalSurfaceRegularization::regularize()</a> method is called another time, the descent starts from the previous results (aka warm restart). Using the default settings (and the trivial normal vectors), we obtain the following reconstruction.</p>
<div class="image">
<img src="regRegul.png" alt=""/>
<div class="caption">
Regularized digital surface (trivial normal vectors).</div></div>
<dl class="section note"><dt>Note</dt><dd>The regularized position can be retrieved using the getREgularizedPosition() method. E.g. <div class="fragment"><div class="line">    <span class="keyword">auto</span> regularizedPosition = regul.getRegularizedPositions();</div>
<div class="line">    <span class="keyword">auto</span> original  = regul.getOriginalPositions();</div>
</div><!-- fragment --> </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>At this point, the digital surface must be closed.</dd></dl>
<p>A key ingredient of the approach is to be able to change the input normal bundle. One can consider normal vectors from <a class="el" href="moduleIntegralInvariant.html">Integral invariant curvature estimator 2D/3D</a>. Normal vectors can be attached using either a functor, a function or a lambda. For example, using <a class="el" href="moduleShortcuts.html">Shortcuts (for the impatient developper)</a></p>
<div class="fragment"><div class="line">    <span class="keyword">auto</span> ii_normals = <a class="code" href="classDGtal_1_1ShortcutsGeometry.html#a4be8870b5d89c075c05bdd928fd3c1ea">SHG3::getIINormalVectors</a>(digitized_shape, surfels, params);</div>
<div class="line">    DigitalSurfaceRegularization&lt;SH3::DigitalSurface&gt; regul(surface);</div>
<div class="line">    regul.init();</div>
<div class="line">    <span class="keyword">auto</span> surfelIndex = regul.getSurfelIndex();</div>
<div class="line">    regul.attachNormalVectors([&amp;](<a class="code" href="classDGtal_1_1Shortcuts.html#aeeb2a89c94e05fbd8b12905296e08125">SH3::SCell</a> &amp;c){ <span class="keywordflow">return</span> ii_normals[ surfelIndex[c] ];} );</div>
<div class="ttc" id="aclassDGtal_1_1ShortcutsGeometry_html_a4be8870b5d89c075c05bdd928fd3c1ea"><div class="ttname"><a href="classDGtal_1_1ShortcutsGeometry.html#a4be8870b5d89c075c05bdd928fd3c1ea">DGtal::ShortcutsGeometry::getIINormalVectors</a></div><div class="ttdeci">static RealVectors getIINormalVectors(CountedPtr&lt; BinaryImage &gt; bimage, const SurfelRange &amp;surfels, const Parameters &amp;params=parametersGeometryEstimation()|parametersKSpace())</div><div class="ttdef"><b>Definition:</b> <a href="ShortcutsGeometry_8h_source.html#l00848">ShortcutsGeometry.h:848</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Shortcuts_html_aeeb2a89c94e05fbd8b12905296e08125"><div class="ttname"><a href="classDGtal_1_1Shortcuts.html#aeeb2a89c94e05fbd8b12905296e08125">DGtal::Shortcuts::SCell</a></div><div class="ttdeci">LightDigitalSurface::SCell SCell</div><div class="ttdef"><b>Definition:</b> <a href="Shortcuts_8h_source.html#l00163">Shortcuts.h:163</a></div></div>
</div><!-- fragment --><p> to obtain </p><div class="image">
<img src="regRegul-II.png" alt=""/>
<div class="caption">
Regularized digital surface (II normal vectors).</div></div>
<p>For piecewise smooth reconstruction, one can consider preprocessing of the normal vector field using <a class="el" href="moduleGenericAT.html">Piecewise-smooth approximation using a discrete calculus model of Ambrosio-Tortorelli functional</a></p>
<h1><a class="anchor" id="moduleReg_seclocal"></a>
Local control</h1>
<p>As discussed above, the user can control the weights \(\alpha\), \(\beta\) and \(\gamma\) per digital surface vertex. For instance using the following weights:</p>
<div class="fragment"><div class="line">    DigitalSurfaceRegularization&lt;SH3::DigitalSurface&gt; regul3(surface);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> i = 0 ; i &lt; original.size(); ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (original[i][0]&lt;0.0)</div>
<div class="line">      {</div>
<div class="line">        alphas[i] = 4.0;</div>
<div class="line">        betas[i]  = 0.0000001;</div>
<div class="line">        gammas[i] = 0.0;</div>
<div class="line">      }</div>
<div class="line">    regul3.init(alphas,betas,gammas);</div>
<div class="line">    regul3.attachConvolvedTrivialNormalVectors(params);</div>
<div class="line">    energybis = regul3.regularize();</div>
</div><!-- fragment --><p> we obtain a regularization with a locally adapted data attachment term.</p>
<div class="image">
<img src="regRegul-local.png" alt=""/>
<div class="caption">
Regularization with local data attachment weight.</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 1 2021 17:06:28 for DGtal by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
